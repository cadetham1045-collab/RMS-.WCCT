
{% extends 'base.html' %}
{% block content %}
<h2>üìà Class Results</h2>

<div class="form" style="max-width:1100px;margin:12px auto;padding:12px">
  <form method="post">
    <label>Select Class</label>
    <select name="class_grade" onchange="this.form.submit()">
      <option value="">-- choose --</option>
      {% for c in classes %}
        <option value="{{c}}" {% if selected_class==c %}selected{% endif %}>Class {{c}}</option>
      {% endfor %}
    </select>
    <noscript><button class="btn" style="margin-top:10px">Load</button></noscript>
  </form>

  {% if selected_class %}
    <form method="post">
      <input type="hidden" name="class_grade" value="{{ selected_class }}">
      <input type="hidden" name="action" value="save_marks">
      <div style="overflow:auto;margin-top:12px">
        <table style="min-width:1000px; border-collapse:collapse">
          <thead>
            <tr>
              <th rowspan="3">Roll</th>
              <th rowspan="3">Name</th>
              <th rowspan="3">House</th>
              {% for subj in subjects %}
                <th colspan="3" style="text-align:center">{{ subj }}</th>
              {% endfor %}
              <th colspan="9" style="text-align:center">üìä TERM-WISE TOTALS</th>
            </tr>
            <tr>
              {% for subj in subjects %}
                <th style="width:70px">1st</th>
                <th style="width:70px">2nd</th>
                <th style="width:70px">Board</th>
              {% endfor %}
              <th style="background:#e3f2fd" colspan="3">1st Term</th>
              <th style="background:#f3e5f5" colspan="3">2nd Term</th>
              <th style="background:#fff3e0" colspan="3">Board</th>
            </tr>
            <tr>
              {% for subj in subjects %}
              {% endfor %}
              <th style="background:#e3f2fd;width:60px">Obt</th>
              <th style="background:#e3f2fd;width:60px">Tot</th>
              <th style="background:#e3f2fd;width:60px">%</th>
              <th style="background:#f3e5f5;width:60px">Obt</th>
              <th style="background:#f3e5f5;width:60px">Tot</th>
              <th style="background:#f3e5f5;width:60px">%</th>
              <th style="background:#fff3e0;width:60px">Obt</th>
              <th style="background:#fff3e0;width:60px">Tot</th>
              <th style="background:#fff3e0;width:60px">%</th>
            </tr>
          </thead>
          <tbody>
            {% for s in results %}
              <tr>
                <td><strong>{{ s.roll }}</strong></td>
                <td>{{ s.name }}</td>
                <td>{{ s.house }}</td>
                {% for subj in subjects %}
                  {% set m = s.marks_by_subject.get(subj) %}
                  {% if m %}
                    <td><input name="m-{{ s.id }}-{{ subj }}-first" value="{{ m.first_term }}" style="width:64px"></td>
                    <td><input name="m-{{ s.id }}-{{ subj }}-second" value="{{ m.second_term }}" style="width:64px"></td>
                    <td><input name="m-{{ s.id }}-{{ subj }}-board" value="{{ m.board }}" style="width:64px"></td>
                  {% else %}
                    <td><input name="m-{{ s.id }}-{{ subj }}-first" value="" style="width:64px"></td>
                    <td><input name="m-{{ s.id }}-{{ subj }}-second" value="" style="width:64px"></td>
                    <td><input name="m-{{ s.id }}-{{ subj }}-board" value="" style="width:64px"></td>
                  {% endif %}
                {% endfor %}
                <!-- 1st Term Totals -->
                <td style="background:#e3f2fd"><strong>{{ '%.1f'|format(s.first_term_obtained) }}</strong></td>
                <td style="background:#e3f2fd">{{ '%.1f'|format(s.first_term_total) }}</td>
                <td style="background:#e3f2fd">{{ '%.1f'|format(s.first_term_percent) }}%</td>
                <!-- 2nd Term Totals -->
                <td style="background:#f3e5f5"><strong>{{ '%.1f'|format(s.second_term_obtained) }}</strong></td>
                <td style="background:#f3e5f5">{{ '%.1f'|format(s.second_term_total) }}</td>
                <td style="background:#f3e5f5">{{ '%.1f'|format(s.second_term_percent) }}%</td>
                <!-- Board Totals -->
                <td style="background:#fff3e0"><strong>{{ '%.1f'|format(s.board_obtained) }}</strong></td>
                <td style="background:#fff3e0">{{ '%.1f'|format(s.board_total) }}</td>
                <td style="background:#fff3e0">{{ '%.1f'|format(s.board_percent) }}%</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div style="margin-top:12px;display:flex;gap:10px">
        <button class="btn" type="submit">Save Marks</button>
        <a class="btn" href="/admin">‚Üê Back</a>
      </div>
    </form>
  {% endif %}
</div>

{% endblock %}
